openapi: "3.0.0"

info:
  $ref: ./info/index.yml

servers:
  $ref: ./servers/index.yml

tags:
  $ref: ./tags/index.yml

paths:
  # BOOSTER endpoint
  /review_booster/send_invitation:
    post:
      $ref: ./paths/review_booster/send_invitation/post.yml
  /review_booster/invitation_status:
    get:
      $ref: ./paths/review_booster/invitation_status/get.yml
  /review_booster/search-invitation:
    get:
      $ref: ./paths/review_booster/search-invitation/get.yml
  # USER endpoints
  /user/me:
    get:
      $ref: ./paths/user/get_me.yml
  /user:
    post:
      $ref: ./paths/user/post.yml
  /user/{user_id}:
    get:
      $ref: ./paths/user/get_by_id.yml
    post:
      $ref: ./paths/user/post_update.yml
    delete:
      $ref: ./paths/user/delete.yml
  /user/search:
    get:
      $ref: ./paths/user/get_search.yml
  /user/search/count:
    get:
      $ref: ./paths/user/get_search_count.yml
  /user/{user_id}/invite:
    post:
      $ref: ./paths/user/post_invite.yml
  /user/{user_id}/businesses:
    get:
      $ref: ./paths/user/get_businesses.yml

  /authorize:
    post:
      tags:
        - ApiKeys
      summary: Generate API key
      description: >
        This endpoint lets you generate an API key either permanent (ie. will work until revoked)
        or consumable (ie. will work only for one connection).
        If you are generating the API key to log your user in the JS API, it is preferable to generate consumable api key.
      operationId: generateAPIKey
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - user_id
              properties:
                user_id:
                  $ref: '#/components/schemas/UserId'
                consumable:
                  type: string
                  default: "False"
                  enum: ["True, False"]
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  user_id:
                    $ref: '#/components/schemas/UserId'
                  user_authorization_token:
                    description: New API key
                    type: string
        400:
          $ref: '#/components/responses/400'
        401:
          $ref: '#/components/responses/401'
        403:
          $ref: '#/components/responses/403'
        404:
          $ref: '#/components/responses/404'
  /authorize/list:
    get:
      summary: List user API keys
      description: >
        This endpoint let you list all the current valid tokens for a given user.
        You need to have `READ` access to this user.
      operationId: listAPIKeys
      tags:
        - ApiKeys
      parameters:
        - in: query
          name: user_id
          schema:
            $ref: '#/components/schemas/UserId'
          description: User id
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  user_id:
                    $ref: '#/components/schemas/UserId'
                  user_authorization_tokens:
                    type: array
                    items:
                      type: string
        400:
          $ref: '#/components/responses/400'
        401:
          $ref: '#/components/responses/401'
        403:
          $ref: '#/components/responses/403'
  /authorize/revoke:
    post:
      summary: Revoke API key
      description: This endpoint let you revoke an API key of one of your user.
      operationId: revokeAPIKey
      tags:
        - ApiKeys
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - user_authorization_token
                - user_id
              properties:
                user_authorization_token:
                  type: string
                  description: The API key you want to revoke
                user_id:
                  $ref: '#/components/schemas/UserId'
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  user_id:
                    $ref: '#/components/schemas/UserId'
                  user_authorization_tokens:
                    type: array
                    items:
                      type: string
                    description: Remaining valid API keys
        400:
          $ref: '#/components/responses/400'
        401:
          $ref: '#/components/responses/401'
        403:
          $ref: '#/components/responses/403'
        404:
          $ref: '#/components/responses/404'

  # REVIEWS endpoints
  /reviews:
    get:
      $ref: ./paths/reviews/get.yml
  /reviews/qualitative-evolution:
    get:
      $ref: ./paths/reviews/get_qualitative_evolution.yml
  /reviews/quantitative-evolution:
    get:
      $ref: ./paths/reviews/get_quantitative_evolution.yml
  /reviews/{review_id}/reply/edit:
    post:
      $ref: ./paths/reviews/post_reply.yml
  /reviews/{review_id}/reply/delete:
    delete:
      $ref: ./paths/reviews/delete_reply.yml

  # ORG endpoints
  /org/{org_id}:
    get:
      $ref: ./paths/organizations/get_by_id.yml
    post:
      $ref: ./paths/organizations/post_update.yml
    delete:
      $ref: ./paths/organizations/delete.yml
  /org/search:
    get:
      $ref: ./paths/organizations/get_search.yml
  /org:
    post:
      $ref: ./paths/organizations/post_create.yml

  # BUSINESS endpoints
  /business/search:
    get:
      operationId: searchBusinesses
      tags:
        - Businesses
      summary: Search for businesses
      description: >
        This lets you search among the businesses you have `READ` access to. You can use several filters.
        The response is paginated (30 results per page).
      parameters:
        - $ref: '#/components/parameters/query_filter_by_fuzzy_query_on_business'
        - $ref: '#/components/parameters/query_filter_by_org_id'
        - $ref: '#/components/parameters/query_filter_by_country'
        - $ref: '#/components/parameters/query_filter_by_business_name'
        - $ref: '#/components/parameters/query_filter_by_business_status'
        - $ref: '#/components/parameters/query_filter_by_zipcode'
        - $ref: '#/components/parameters/query_filter_by_city'
        - $ref: '#/components/parameters/query_filter_by_business_code'
        - $ref: '#/components/parameters/query_filter_by_business_modification_timestamp'
        - $ref: '#/components/parameters/query_filter_by_business_subscription_to_review_management'
        - $ref: '#/components/parameters/query_filter_by_business_subscription_to_presence_management'
        - $ref: '#/components/parameters/query_filter_by_business_promo'
        - $ref: '#/components/parameters/query_filter_by_business_code'
        - $ref: '#/components/parameters/query_page'
        - in: query
          name: connected_to_gmb_location
          schema:
            type: string
            enum:
              - "True"
              - "False"
          required: false
          description: Filter by current link to a GMB location
        - in: query
          name: connected_to_facebook_location
          schema:
            type: string
            enum:
              - "True"
              - "False"
          required: false
          description: Filter by current link to a Facebook location
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ListResult'
                  - type: object
                    properties:
                      businesses:
                        type: array
                        description: List of Businesses
                        items:
                          $ref: '#/components/schemas/Business'
        400:
          $ref: '#/components/responses/400'
        401:
          $ref: '#/components/responses/401'
  /business:
    post:
      tags:
        - Businesses
      summary: Create business
      operationId: createBusiness
      requestBody:
        required: true
        content:
          application/json:
            schema:
              description: Request object
              type: object
              required:
                - name
                - country
                - zipcode
                - city
                - categories
              properties:
                name:
                  $ref: '#/components/schemas/BusinessName'
                org_id:
                  $ref: '#/components/schemas/BusinessOrgId'
                country:
                  $ref: '#/components/schemas/BusinessCountry'
                zipcode:
                  $ref: '#/components/schemas/BusinessZipcode'
                city:
                  $ref: '#/components/schemas/BusinessCity'
                region:
                  $ref: '#/components/schemas/BusinessRegion'
                categories:
                  description: Array of categories ids
                  type: array
                  minItems: 1
                  items:
                    type: string
                code:
                  $ref: '#/components/schemas/BusinessCode'
                status:
                  $ref: '#/components/schemas/BusinessStatus'
                address_details:
                  $ref: '#/components/schemas/AddressDetails'
                address2:
                  type: string
                lat:
                  $ref: '#/components/schemas/Latitude'
                long:
                  $ref: '#/components/schemas/Longitude'
                website_url:
                  $ref: '#/components/schemas/BusinessWebsite'
                facebook_url:
                  $ref: '#/components/schemas/BusinessFacebookPage'
                twitter_url:
                  $ref: '#/components/schemas/BusinessTwitter'
                description_short:
                  $ref: '#/components/schemas/BusinessShortDescription'
                description_long:
                  $ref: '#/components/schemas/BusinessLongDescription'
                open_hours:
                  $ref: '#/components/schemas/OpenHours'
                specific_hours:
                  $ref: '#/components/schemas/SpecificHours'
                contacts:
                  $ref: '#/components/schemas/BusinessContacts'
                photos:
                  $ref: '#/components/schemas/Photos'
                national_identification_number:
                  $ref: '#/components/schemas/BusinessNationalIdentificationNumber'
                videos:
                  $ref: '#/components/schemas/BusinessVideos'
                news:
                  $ref: '#/components/schemas/BusinessNews'
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    $ref: '#/components/schemas/RequestStatus'
                  id:
                    $ref: '#/components/schemas/BusinessId'
        400:
          $ref: '#/components/responses/400'
        401:
          $ref: '#/components/responses/401'
        403:
          $ref: '#/components/responses/403'
  /business/connections_stats:
    get:
      tags:
        - Businesses
      operationId: getBusinessConnectionsStats
      summary: Get statistics about connected businesses
      description: >
        This endpoint lets you access the number of businesses connected to Google My Business and Facebook.
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  count:
                    type: integer
                    description: >
                      Total number of businesses.
                  linked_to_gmb_count:
                    type: integer
                    description: >
                      Number of businesses linked to Google My Business.
                  linked_to_facebook_count:
                    type: integer
                    description: >
                      Number of businesses linked to Facebook.
        401:
          $ref: '#/components/responses/401'
  /business/{business_id}:
    get:
      tags:
        - Businesses
      operationId: getBusiness
      summary: Get business
      description: >
        This endpoint lets you access to the information of a business.
        You need to have `READ`access on this business.
      parameters:
        - $ref: '#/components/parameters/business_id'
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Business'
        401:
          $ref: '#/components/responses/401'
        403:
          $ref: '#/components/responses/403'
        404:
          $ref: '#/components/responses/404'
    post:
      tags:
        - Businesses
      operationId: updateBusiness
      summary: Update business
      description: >
        This endpoint lets you access to the information of a business.
        You need to have `WRITE` access on this business.
        Only indicated values be taken into account (it works like a `PATCH`).
      parameters:
        - $ref: '#/components/parameters/business_id'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              description: Request object
              type: object
              properties:
                name:
                  $ref: '#/components/schemas/BusinessName'
                org_id:
                  $ref: '#/components/schemas/BusinessOrgId'
                country:
                  $ref: '#/components/schemas/BusinessCountry'
                zipcode:
                  $ref: '#/components/schemas/BusinessZipcode'
                city:
                  $ref: '#/components/schemas/BusinessCity'
                region:
                  $ref: '#/components/schemas/BusinessRegion'
                categories:
                  description: Array of categories ids
                  type: array
                  minItems: 1
                  items:
                    type: string
                code:
                  $ref: '#/components/schemas/BusinessCode'
                status:
                  $ref: '#/components/schemas/BusinessStatus'
                address_details:
                  $ref: '#/components/schemas/AddressDetails'
                address2:
                  description: Row address string
                  type: string
                lat:
                  $ref: '#/components/schemas/Latitude'
                long:
                  $ref: '#/components/schemas/Longitude'
                website_url:
                  $ref: '#/components/schemas/BusinessWebsite'
                facebook_url:
                  $ref: '#/components/schemas/BusinessFacebookPage'
                twitter_url:
                  $ref: '#/components/schemas/BusinessTwitter'
                description_short:
                  $ref: '#/components/schemas/BusinessShortDescription'
                description_long:
                  $ref: '#/components/schemas/BusinessLongDescription'
                open_hours:
                  $ref: '#/components/schemas/OpenHours'
                specific_hours:
                  $ref: '#/components/schemas/SpecificHours'
                contacts:
                  $ref: '#/components/schemas/BusinessContacts'
                photos:
                  $ref: '#/components/schemas/Photos'
                national_identification_number:
                  $ref: '#/components/schemas/BusinessNationalIdentificationNumber'
                videos:
                  $ref: '#/components/schemas/BusinessVideos'
                news:
                  $ref: '#/components/schemas/BusinessNews'
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Business'
        400:
          $ref: '#/components/responses/400'
        401:
          $ref: '#/components/responses/401'
        403:
          $ref: '#/components/responses/403'
        404:
          $ref: '#/components/responses/404'
    delete:
      tags:
        - Businesses
      operationId: deleteBusiness
      summary: Delete business
      description: >
        This endpoint lets you delete a business.
        You need to have `WRITE`access on this business.
      parameters:
        - $ref: '#/components/parameters/business_id'
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                description: Response object
                type: object
                properties:
                  id:
                    $ref: '#/components/schemas/BusinessId'
                  status:
                    $ref: '#/components/schemas/RequestStatus'
        400:
          $ref: '#/components/responses/400'
        401:
          $ref: '#/components/responses/401'
        403:
          $ref: '#/components/responses/403'
        404:
          $ref: '#/components/responses/404'
  /business/{business_id}/partner_urls:
    get:
      tags:
        - Businesses
      operationId: getBusinessPartnerUrls
      summary: Get business urls on publishers
      description: >
        This endpoint lets you access to the urls corresponding to the business on publisher websites.
        You need to have `READ` access on this business.
      parameters:
        - $ref: '#/components/parameters/business_id'
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                type: object
                description: URL by publisher
                properties:
                  apple:
                    type: string
                    format: uri
                  le118000:
                    type: string
                    format: uri
                  les_horaires:
                    type: string
                    format: uri
                  wemap:
                    type: string
                    format: uri
                  here:
                    type: string
                    format: uri
                  google_my_business:
                    type: string
                    format: uri
                  hoodspot:
                    type: string
                    format: uri
                  foursquare:
                    type: string
                    format: uri
                  facebook:
                    type: string
                    format: uri
                  justacote:
                    type: string
                    format: uri
                  navmii:
                    type: string
                    format: uri
                  bing_fr:
                    type: string
                    format: uri
        401:
          $ref: '#/components/responses/401'
        403:
          $ref: '#/components/responses/403'
        404:
          $ref: '#/components/responses/404'
  /business/{business_id}/integration_status:
    get:
      tags:
        - Businesses
      operationId: getBusinessIntegrationStatus
      summary: Get business integration data
      description: >
        This endpoint lets you access to the data summarizing the integration state of a business on publishers.
        You need to have `READ` access on this business.
      parameters:
        - $ref: '#/components/parameters/business_id'
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                type: object
                description: URL by publisher
                properties:
                  apple:
                    $ref: '#/components/schemas/IntegrationData'
                  le118000:
                    $ref: '#/components/schemas/IntegrationData'
                  les_horaires:
                    $ref: '#/components/schemas/IntegrationData'
                  wemap:
                    $ref: '#/components/schemas/IntegrationData'
                  here:
                    $ref: '#/components/schemas/IntegrationData'
                  google_my_business:
                    $ref: '#/components/schemas/IntegrationData'
                  hoodspot:
                    $ref: '#/components/schemas/IntegrationData'
                  foursquare:
                    $ref: '#/components/schemas/IntegrationData'
                  facebook:
                    $ref: '#/components/schemas/IntegrationData'
                  justacote:
                    $ref: '#/components/schemas/IntegrationData'
                  navmii:
                    $ref: '#/components/schemas/IntegrationData'
                  bing_fr:
                    $ref: '#/components/schemas/IntegrationData'
        401:
          $ref: '#/components/responses/401'
        403:
          $ref: '#/components/responses/403'
        404:
          $ref: '#/components/responses/404'
  /business/{business_id}/subscription:
    get:
      tags:
        - Businesses
      operationId: getBusinessSubscriptions
      summary: Get business subscriptions
      description: >
        This endpoint lets you access the subscription of a business.
        You need to have `READ` access on this business.
      parameters:
        - $ref: '#/components/parameters/business_id'
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                type: object
                description: Business subscriptions
                properties:
                  presence_management:
                    $ref: '#/components/schemas/SubscriptionDetails'
                  review_management:
                    $ref: '#/components/schemas/SubscriptionDetails'
        401:
          $ref: '#/components/responses/401'
        403:
          $ref: '#/components/responses/403'
        404:
          $ref: '#/components/responses/404'
  /business/{business_id}/additional_data:
    get:
      tags:
        - Businesses
      operationId: getBusinessAdditionalData
      summary: Get business additional data
      description: >
        This endpoint lets you access to the additional data of business.
        You need to have `READ`access on this business.
      parameters:
        - $ref: '#/components/parameters/business_id'
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                type: object
                description: Business additional data
        401:
          $ref: '#/components/responses/401'
        403:
          $ref: '#/components/responses/403'
        404:
          $ref: '#/components/responses/404'
    post:
      tags:
        - Businesses
      operationId: setBusinessAdditionalData
      summary: Set business additional data
      description: >
        This endpoint lets you set additional data on a business.
        You need to have `WRITE`access on this business.
        Additional is an flat object with at most 10 keys.
      parameters:
        - $ref: '#/components/parameters/business_id'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              description: A flat object (ie. without nested value) with at most 10 keys
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    $ref: '#/components/schemas/BusinessId'
                  status:
                    $ref: '#/components/schemas/RequestStatus'
        401:
          $ref: '#/components/responses/401'
        403:
          $ref: '#/components/responses/403'
        404:
          $ref: '#/components/responses/404'
  /business/{business_id}/subscribe:
    post:
      summary: Subscribe a business
      description: >
        This endpoint lets you subscribe a business to one or several Partoo products.
        You need to have `WRITE` access on the business you want to subscribe.
        You need to have `PROVIDER` to be able to perform this action.
      tags:
        - Subscriptions
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                subscription_date:
                  type: number
                  description: Timestamp representing the date on which the subscription will start
                  example: 1540628702
                products:
                  type: array
                  description: List of products
                  items:
                    $ref: '#/components/schemas/Product'
                plan:
                  type: string
                  description: Any string that define your offer
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  presence_management:
                    oneOf:
                      - $ref: '#/components/schemas/ProductSubscribeResponseObject'
                      - $ref: '#/components/schemas/ProductUnsubscribeResponseObject'
                  review_management:
                    oneOf:
                      - $ref: '#/components/schemas/ProductSubscribeResponseObject'
                      - $ref: '#/components/schemas/ProductUnsubscribeResponseObject'
                  review_booster:
                    oneOf:
                      - $ref: '#/components/schemas/ProductSubscribeResponseObject'
                      - $ref: '#/components/schemas/ProductUnsubscribeResponseObject'
        400:
          $ref: '#/components/responses/400'
        401:
          $ref: '#/components/responses/401'
        403:
          $ref: '#/components/responses/403'
        404:
          $ref: '#/components/responses/404'
  /business/{business_id}/unsubscribe:
    post:
      summary: Unsubscribe a business
      description: >
        This endpoint lets you unsubscribe a business from one or several Partoo products.
        You need to have `WRITE` access on the business you want to subscribe.
        You need to have `PROVIDER` to be able to perform this action.
      tags:
        - Subscriptions
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                canceling_date:
                  type: number
                  description: Timestamp representing the date on which the subscription will stop to be valid
                  example: 1540628702
                products:
                  type: array
                  description: List of products
                  items:
                    $ref: '#/components/schemas/Product'
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  presence_management:
                    oneOf:
                      - $ref: '#/components/schemas/ProductSubscribeResponseObject'
                      - $ref: '#/components/schemas/ProductUnsubscribeResponseObject'
                  review_management:
                    oneOf:
                      - $ref: '#/components/schemas/ProductSubscribeResponseObject'
                      - $ref: '#/components/schemas/ProductUnsubscribeResponseObject'
                  review_booster:
                    oneOf:
                      - $ref: '#/components/schemas/ProductSubscribeResponseObject'
                      - $ref: '#/components/schemas/ProductUnsubscribeResponseObject'
        400:
          $ref: '#/components/responses/400'
        401:
          $ref: '#/components/responses/401'
        403:
          $ref: '#/components/responses/403'
        404:
          $ref: '#/components/responses/404'

  # CATEGORY endpoints
  /category/search:
    get:
      summary: Search categories
      tags:
        - Categories
      description: >
        This endpoint lets you search through Partoo categories.
      operationId: searchCategories
      parameters:
        - $ref: '#/components/parameters/query_category_lang'
        - $ref: '#/components/parameters/query_page'
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ListResult'
                  - type: object
                    properties:
                      categories:
                        type: array
                        description: List of categories
                        items:
                          $ref: '#/components/schemas/Category'
        400:
          $ref: '#/components/responses/400'
        401:
          $ref: '#/components/responses/401'
  /category/{category_id}:
    get:
      summary: Get category
      tags:
        - Categories
      description: >
        This endpoint lets you retrieve the data of a specific category.
      operationId: getCategory
      parameters:
        - in: path
          required: true
          name: category_id
          schema:
            $ref: '#/components/schemas/CategoryId'
        - $ref: '#/components/parameters/query_category_lang'
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Category'
        400:
          $ref: '#/components/responses/400'
        401:
          $ref: '#/components/responses/401'

  # PRESENCE ANALYTICS endpoints
  /presence_analytics:
    get:
      $ref: ./paths/presence_analytics/get.yml
  /presence_analytics_export:
    get:
      $ref: ./paths/presence_analytics/get_export.yml

components:
  $ref: ./components/index.yml
security:
  - ApiKeyAuth: []
